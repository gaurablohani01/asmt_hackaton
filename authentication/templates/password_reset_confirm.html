{% extends 'base.html' %}

{% block title %}Reset Password - ShareTracker{% endblock %}

{% block content %}
<div class="fade-in" style="max-width: 500px; margin: 0 auto;">
    <div class="card">
        {% if valid_link %}
            <div class="card-header" style="text-align: center;">
                <h1 class="card-title">üîë Set New Password</h1>
                <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                    Enter your new password below
                </p>
            </div>

            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            <form method="post" id="passwordResetConfirmForm">
                {% csrf_token %}
                
                <div class="form-group">
                    <label for="new_password" class="form-label">New Password</label>
                    <input 
                        type="password" 
                        name="new_password" 
                        id="new_password" 
                        class="form-input" 
                        placeholder="Enter your new password"
                        required
                        minlength="6"
                        autocomplete="new-password"
                    >
                    <small style="color: var(--text-secondary); font-size: 0.8rem;">
                        At least 6 characters for security
                    </small>
                </div>

                <div class="form-group">
                    <label for="confirm_new_password" class="form-label">Confirm New Password</label>
                    <input 
                        type="password" 
                        name="confirm_new_password" 
                        id="confirm_new_password" 
                        class="form-input" 
                        placeholder="Confirm your new password"
                        required
                        autocomplete="new-password"
                    >
                    <small id="passwordMatch" style="font-size: 0.8rem; display: none;"></small>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;" id="submitBtn">
                    Update Password
                </button>
            </form>

            <div style="text-align: center; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                    Password updated successfully?
                </p>
                <a href="{% url 'login' %}" class="btn btn-secondary">
                    Go to Login
                </a>
            </div>
        {% else %}
            <div class="card-header" style="text-align: center;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">‚ùå</div>
                <h1 class="card-title" style="color: #ef4444;">Invalid Reset Link</h1>
                <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                    This password reset link is invalid or has expired
                </p>
            </div>

            <div style="text-align: center; margin-top: 1rem;">
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                    The reset link may have expired or been used already. Please request a new one.
                </p>
                
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <a href="{% url 'password_reset_request' %}" class="btn btn-primary">
                        Request New Link
                    </a>
                    <a href="{% url 'login' %}" class="btn btn-secondary">
                        Back to Login
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
</div>

<style>
.alert {
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    font-size: 0.9rem;
}

.alert-success {
    background-color: rgba(34, 197, 94, 0.1);
    color: #22c55e;
    border: 1px solid rgba(34, 197, 94, 0.2);
}

.alert-error {
    background-color: rgba(239, 68, 68, 0.1);
    color: #ef4444;
    border: 1px solid rgba(239, 68, 68, 0.2);
}

.alert-info {
    background-color: rgba(59, 130, 246, 0.1);
    color: #3b82f6;
    border: 1px solid rgba(59, 130, 246, 0.2);
}

#passwordResetConfirmForm {
    margin-bottom: 0;
}

.form-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
}

.btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.btn:active {
    transform: translateY(0);
}

.password-match {
    color: #22c55e;
}

.password-no-match {
    color: #ef4444;
}

@media (max-width: 640px) {
    .card {
        margin: 1rem;
        padding: 1.5rem;
    }
    
    .card-header h1 {
        font-size: 1.5rem;
    }
    
    .btn {
        min-width: 120px;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const newPassword = document.getElementById('new_password');
    const confirmPassword = document.getElementById('confirm_new_password');
    const passwordMatch = document.getElementById('passwordMatch');
    const submitBtn = document.getElementById('submitBtn');

    function checkPasswordMatch() {
        if (confirmPassword.value === '') {
            passwordMatch.style.display = 'none';
            return;
        }

        passwordMatch.style.display = 'block';
        
        if (newPassword.value === confirmPassword.value) {
            passwordMatch.textContent = '‚úì Passwords match';
            passwordMatch.className = 'password-match';
            submitBtn.disabled = false;
        } else {
            passwordMatch.textContent = '‚úó Passwords do not match';
            passwordMatch.className = 'password-no-match';
            submitBtn.disabled = true;
        }
    }

    if (newPassword && confirmPassword) {
        newPassword.addEventListener('input', checkPasswordMatch);
        confirmPassword.addEventListener('input', checkPasswordMatch);
    }
});
</script>
{% endblock %}
